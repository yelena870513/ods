!function(context){function Lazy(source){if(source instanceof Array)return new ArrayWrapper(source);if("string"==typeof source)return new StringWrapper(source);if(source instanceof Sequence)return source;if(Lazy.extensions){for(var result,extensions=Lazy.extensions,length=extensions.length;!result&&length--;)result=extensions[length](source);if(result)return result}return new ObjectWrapper(source)}function Sequence(){}function Iterator(sequence){this.sequence=sequence,this.index=-1}function MemoizedSequence(parent){this.parent=parent}function MappedSequence(parent,mapFn){this.parent=parent,this.mapFn=mapFn}function MappingIterator(sequence,mapFn){this.iterator=sequence.getIterator(),this.mapFn=mapFn,this.index=-1}function FilteredSequence(parent,filterFn){this.parent=parent,this.filterFn=filterFn}function FilteringIterator(sequence,filterFn){this.iterator=sequence.getIterator(),this.filterFn=filterFn,this.index=0}function ReversedSequence(parent){this.parent=parent}function ReversedIterator(sequence){this.sequence=sequence}function ConcatenatedSequence(parent,arrays){this.parent=parent,this.arrays=arrays}function TakeSequence(parent,count){this.parent=parent,this.count=count}function TakeIterator(sequence,count){this.iterator=sequence.getIterator(),this.count=count}function TakeWhileSequence(parent,predicate){this.parent=parent,this.predicate=predicate}function DropSequence(parent,count){this.parent=parent,this.count="number"==typeof count?count:1}function DropWhileSequence(parent,predicate){this.parent=parent,this.predicate=predicate}function SortedSequence(parent,sortFn){this.parent=parent,this.sortFn=sortFn}function GroupedSequence(parent,keyFn){this.parent=parent,this.keyFn=keyFn}function CountedSequence(parent,keyFn){this.parent=parent,this.keyFn=keyFn}function UniqueSequence(parent,keyFn){this.parent=parent,this.keyFn=keyFn}function ZippedSequence(parent,arrays){this.parent=parent,this.arrays=arrays}function ShuffledSequence(parent){this.parent=parent}function FlattenedSequence(parent){this.parent=parent}function WithoutSequence(parent,values){this.parent=parent,this.values=values}function IntersectionSequence(parent,arrays){this.parent=parent,this.arrays=arrays}function UniqueMemoizer(iterator){this.iterator=iterator,this.set=new Set,this.memo=[],this.currentValue=void 0}function ChunkedSequence(parent,size){this.parent=parent,this.chunkSize=size}function ChunkedIterator(sequence,size){this.iterator=sequence.getIterator(),this.size=size}function TappedSequence(parent,callback){this.parent=parent,this.callback=callback}function SimpleIntersectionSequence(parent,array){this.parent=parent,this.array=array,this.each=getEachForIntersection(array)}function getEachForIntersection(source){return source.length<40?SimpleIntersectionSequence.prototype.eachArrayCache:SimpleIntersectionSequence.prototype.eachMemoizerCache}function SimpleZippedSequence(parent,array){this.parent=parent,this.array=array}function ArrayLikeSequence(){}function IndexedIterator(sequence){this.sequence=sequence,this.index=-1}function IndexedMappedSequence(parent,mapFn){this.parent=parent,this.mapFn=mapFn}function IndexedFilteredSequence(parent,filterFn){this.parent=parent,this.filterFn=filterFn}function IndexedReversedSequence(parent){this.parent=parent}function IndexedTakeSequence(parent,count){this.parent=parent,this.count=count}function IndexedDropSequence(parent,count){this.parent=parent,this.count="number"==typeof count?count:1}function IndexedConcatenatedSequence(parent,other){this.parent=parent,this.other=other}function IndexedUniqueSequence(parent,keyFn){this.parent=parent,this.each=getEachForParent(parent),this.keyFn=keyFn}function getEachForParent(parent){return parent.length()<100?IndexedUniqueSequence.prototype.eachArrayCache:UniqueSequence.prototype.each}function ArrayWrapper(source){this.source=source}function MappedArrayWrapper(parent,mapFn){this.parent=parent,this.mapFn=mapFn}function FilteredArrayWrapper(parent,filterFn){this.parent=parent,this.filterFn=filterFn}function UniqueArrayWrapper(parent,keyFn){this.parent=parent,this.each=getEachForSource(parent.source),this.keyFn=keyFn}function getEachForSource(source){return source.length<40?UniqueArrayWrapper.prototype.eachNoCache:source.length<100?UniqueArrayWrapper.prototype.eachArrayCache:UniqueArrayWrapper.prototype.eachSetCache}function ConcatArrayWrapper(parent,other){this.parent=parent,this.other=other}function ObjectLikeSequence(){}function AssignSequence(parent,other){this.parent=parent,this.other=other}function DefaultsSequence(parent,defaults){this.parent=parent,this.defaults=defaults}function InvertedSequence(parent){this.parent=parent}function MergedSequence(parent,others,mergeFn){this.parent=parent,this.others=others,this.mergeFn=mergeFn}function mergeObjects(a,b){if("undefined"==typeof b)return a;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return b;var prop,merged={};for(prop in a)merged[prop]=mergeObjects(a[prop],b[prop]);for(prop in b)merged[prop]||(merged[prop]=b[prop]);return merged}function PickSequence(parent,properties){this.parent=parent,this.properties=properties}function OmitSequence(parent,properties){this.parent=parent,this.properties=properties}function ObjectWrapper(source){this.source=source}function StringLikeSequence(){}function CharIterator(source){this.source=Lazy(source),this.index=-1}function StringSegment(parent,start,stop){this.parent=parent,this.start=Math.max(0,start),this.stop=stop}function MappedStringLikeSequence(parent,mapFn){this.parent=parent,this.mapFn=mapFn}function ReversedStringLikeSequence(parent){this.parent=parent}function StringMatchSequence(source,pattern){this.source=source,this.pattern=pattern}function StringMatchIterator(source,pattern){this.source=source,this.pattern=cloneRegex(pattern)}function SplitStringSequence(source,pattern){this.source=source,this.pattern=pattern}function SplitWithRegExpIterator(source,pattern){this.source=source,this.pattern=cloneRegex(pattern)}function SplitWithStringIterator(source,delimiter){this.source=source,this.delimiter=delimiter}function StringWrapper(source){this.source=source}function GeneratedSequence(generatorFn,length){this.get=generatorFn,this.fixedLength=length}function GeneratedIterator(sequence){this.sequence=sequence,this.index=0,this.currentValue=null}function AsyncSequence(parent,interval){if(parent instanceof AsyncSequence)throw"Sequence is already asynchronous!";this.parent=parent,this.interval=interval,this.onNextCallback=getOnNextCallback(interval)}function AsyncHandle(interval){this.cancelCallback=getCancelCallback(interval)}function getOnNextCallback(interval){return"undefined"==typeof interval&&"function"==typeof setImmediate?setImmediate:(interval=interval||0,function(fn){return setTimeout(fn,interval)})}function getCancelCallback(interval){return"undefined"==typeof interval&&"function"==typeof clearImmediate?clearImmediate:clearTimeout}function WatchedPropertySequence(object,propertyNames){this.listeners=[],propertyNames?propertyNames instanceof Array||(propertyNames=[propertyNames]):propertyNames=Lazy(object).keys().toArray();var listeners=this.listeners,index=0;Lazy(propertyNames).each(function(propertyName){var propertyValue=object[propertyName];Object.defineProperty(object,propertyName,{get:function(){return propertyValue},set:function(value){for(var i=listeners.length-1;i>=0;--i)listeners[i]({property:propertyName,value:value},index)===!1&&listeners.splice(i,1);propertyValue=value,++index}})})}function StreamLikeSequence(){}function SplitStreamSequence(parent,delimiter){this.parent=parent,this.delimiter=delimiter}function MatchedStreamSequence(parent,pattern){this.parent=parent,this.pattern=cloneRegex(pattern)}function createCallback(callback,defaultValue){switch(typeof callback){case"function":return callback;case"string":return function(e){return e[callback]};case"object":return function(e){return Lazy(callback).all(function(value,key){return e[key]===value})};case"undefined":return defaultValue?function(){return defaultValue}:Lazy.identity;default:throw"Don't know how to make a callback from a "+typeof callback+"!"}}function createSet(values){var set=new Set;return Lazy(values||[]).flatten().each(function(e){set.add(e)}),set}function compare(x,y,fn){return"function"==typeof fn?compare(fn(x),fn(y)):x===y?0:x>y?1:-1}function forEach(array,fn){for(var i=-1,len=array.length;++i<len;)if(fn(array[i],i)===!1)return!1;return!0}function getFirst(sequence){var result;return sequence.each(function(e){return result=e,!1}),result}function arrayContains(array,element){var i=-1,length=array.length;if(element!==element){for(;++i<length;)if(array[i]!==array[i])return!0;return!1}for(;++i<length;)if(array[i]===element)return!0;return!1}function arrayContainsBefore(array,element,index,keyFn){var i=-1;if(keyFn){for(keyFn=createCallback(keyFn);++i<index;)if(keyFn(array[i])===keyFn(element))return!0}else for(;++i<index;)if(array[i]===element)return!0;return!1}function swap(array,i,j){var temp=array[i];array[i]=array[j],array[j]=temp}function cloneRegex(pattern){return eval(""+pattern+(pattern.global?"":"g"))}function Set(){this.table={},this.objects=[]}function Queue(capacity){this.contents=new Array(capacity),this.start=0,this.count=0}function defineSequenceType(base,name,overrides){var ctor=function(){};ctor.prototype=new base;for(var override in overrides)ctor.prototype[override]=overrides[override];for(var factory=function(){var sequence=new ctor;return sequence.parent=this,sequence.init&&sequence.init.apply(sequence,arguments),sequence},methodNames="string"==typeof name?[name]:name,i=0;i<methodNames.length;++i)base.prototype[methodNames[i]]=factory;return ctor}Lazy.VERSION="0.3.2",Lazy.noop=function(){},Lazy.identity=function(x){return x},Lazy.strict=function(){function StrictLazy(source){if(null==source)throw"You cannot wrap null or undefined using Lazy.";if("number"==typeof source||"boolean"==typeof source)throw"You cannot wrap primitive values using Lazy.";return Lazy(source)}return Lazy(Lazy).each(function(property,name){StrictLazy[name]=property}),StrictLazy},Sequence.define=function(methodName,overrides){if(!overrides||!overrides.getIterator&&!overrides.each)throw"A custom sequence must implement *at least* getIterator or each!";return defineSequenceType(Sequence,methodName,overrides)},Sequence.prototype.size=function(){return this.getIndex().length()},Sequence.prototype.getIterator=function(){return new Iterator(this)},Sequence.prototype.root=function(){return this.parent.root()},Sequence.prototype.value=function(){return this.toArray()},Sequence.prototype.apply=function(source){var result,root=this.root(),previousSource=root.source;try{root.source=source,result=this.value()}finally{root.source=previousSource}return result},Iterator.prototype.current=function(){return this.cachedIndex&&this.cachedIndex.get(this.index)},Iterator.prototype.moveNext=function(){var cachedIndex=this.cachedIndex;return cachedIndex||(cachedIndex=this.cachedIndex=this.sequence.getIndex()),this.index>=cachedIndex.length()-1?!1:(++this.index,!0)},Sequence.prototype.toArray=function(){return this.reduce(function(arr,element){return arr.push(element),arr},[])},Sequence.prototype.getIndex=function(){return this.cachedIndex||(this.cachedIndex=new ArrayWrapper(this.toArray())),this.cachedIndex},Sequence.prototype.memoize=function(){return new MemoizedSequence(this)},Sequence.prototype.toObject=function(){return this.reduce(function(object,pair){return object[pair[0]]=pair[1],object},{})},Sequence.prototype.each=function(fn){for(var iterator=this.getIterator(),i=-1;iterator.moveNext();)if(fn(iterator.current(),++i)===!1)return!1;return!0},Sequence.prototype.forEach=function(fn){return this.each(fn)},Sequence.prototype.map=function(mapFn){return new MappedSequence(this,createCallback(mapFn))},Sequence.prototype.collect=function(mapFn){return this.map(mapFn)},MappedSequence.prototype=new Sequence,MappedSequence.prototype.getIterator=function(){return new MappingIterator(this.parent,this.mapFn)},MappedSequence.prototype.each=function(fn){var mapFn=this.mapFn;return this.parent.each(function(e,i){return fn(mapFn(e,i),i)})},MappingIterator.prototype.current=function(){return this.mapFn(this.iterator.current(),this.index)},MappingIterator.prototype.moveNext=function(){return this.iterator.moveNext()?(++this.index,!0):!1},Sequence.prototype.pluck=function(property){return this.map(property)},Sequence.prototype.invoke=function(methodName){return this.map(function(e){return e[methodName]()})},Sequence.prototype.filter=function(filterFn){return new FilteredSequence(this,createCallback(filterFn))},Sequence.prototype.select=function(filterFn){return this.filter(filterFn)},FilteredSequence.prototype=new Sequence,FilteredSequence.prototype.getIterator=function(){return new FilteringIterator(this.parent,this.filterFn)},FilteredSequence.prototype.each=function(fn){var filterFn=this.filterFn;return this.parent.each(function(e,i){return filterFn(e,i)?fn(e,i):void 0})},FilteredSequence.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)},FilteringIterator.prototype.current=function(){return this.value},FilteringIterator.prototype.moveNext=function(){for(var value,iterator=this.iterator,filterFn=this.filterFn;iterator.moveNext();)if(value=iterator.current(),filterFn(value,this.index++))return this.value=value,!0;return this.value=void 0,!1},Sequence.prototype.reject=function(rejectFn){return rejectFn=createCallback(rejectFn),this.filter(function(e){return!rejectFn(e)})},Sequence.prototype.ofType=function(type){return this.filter(function(e){return typeof e===type})},Sequence.prototype.where=function(properties){return this.filter(properties)},Sequence.prototype.reverse=function(){return new ReversedSequence(this)},ReversedSequence.prototype=new Sequence,ReversedSequence.prototype.getIterator=function(){return new ReversedIterator(this.parent)},ReversedIterator.prototype.current=function(){return this.sequence.getIndex().get(this.index)},ReversedIterator.prototype.moveNext=function(){var indexed=this.sequence.getIndex(),length=indexed.length();return"undefined"==typeof this.index&&(this.index=length),--this.index>=0},Sequence.prototype.concat=function(var_args){return new ConcatenatedSequence(this,arraySlice.call(arguments,0))},ConcatenatedSequence.prototype=new Sequence,ConcatenatedSequence.prototype.each=function(fn){var done=!1,i=0;this.parent.each(function(e){return fn(e,i++)===!1?(done=!0,!1):void 0}),done||Lazy(this.arrays).flatten().each(function(e){return fn(e,i++)===!1?!1:void 0})},Sequence.prototype.first=function(count){return"undefined"==typeof count?getFirst(this):new TakeSequence(this,count)},Sequence.prototype.head=Sequence.prototype.take=function(count){return this.first(count)},TakeSequence.prototype=new Sequence,TakeSequence.prototype.getIterator=function(){return new TakeIterator(this.parent,this.count)},TakeSequence.prototype.each=function(fn){var count=this.count,i=0;this.parent.each(function(e){var result;return count>i&&(result=fn(e,i)),++i>=count?!1:result})},TakeIterator.prototype.current=function(){return this.iterator.current()},TakeIterator.prototype.moveNext=function(){return--this.count>=0&&this.iterator.moveNext()},Sequence.prototype.takeWhile=function(predicate){return new TakeWhileSequence(this,predicate)},TakeWhileSequence.prototype=new Sequence,TakeWhileSequence.prototype.each=function(fn){var predicate=this.predicate;this.parent.each(function(e){return predicate(e)&&fn(e)})},Sequence.prototype.initial=function(count){return"undefined"==typeof count&&(count=1),this.take(this.getIndex().length()-count)},Sequence.prototype.last=function(count){return"undefined"==typeof count?this.reverse().first():this.reverse().take(count).reverse()},Sequence.prototype.findWhere=function(properties){return this.where(properties).first()},Sequence.prototype.rest=function(count){return new DropSequence(this,count)},Sequence.prototype.skip=Sequence.prototype.tail=Sequence.prototype.drop=function(count){return this.rest(count)},DropSequence.prototype=new Sequence,DropSequence.prototype.each=function(fn){var count=this.count,dropped=0,i=0;this.parent.each(function(e){return dropped++<count?void 0:fn(e,i++)})},Sequence.prototype.dropWhile=function(predicate){return new DropWhileSequence(this,predicate)},Sequence.prototype.skipWhile=function(predicate){return this.dropWhile(predicate)},DropWhileSequence.prototype=new Sequence,DropWhileSequence.prototype.each=function(fn){var predicate=this.predicate,done=!1;this.parent.each(function(e){if(!done){if(predicate(e))return;done=!0}return fn(e)})},Sequence.prototype.sortBy=function(sortFn){return new SortedSequence(this,sortFn)},SortedSequence.prototype=new Sequence,SortedSequence.prototype.each=function(fn){var sortFn=createCallback(this.sortFn),sorted=this.parent.toArray();return sorted.sort(function(x,y){return compare(x,y,sortFn)}),forEach(sorted,fn)},Sequence.prototype.groupBy=function(keyFn){return new GroupedSequence(this,keyFn)},Sequence.prototype.countBy=function(keyFn){return new CountedSequence(this,keyFn)},Sequence.prototype.uniq=function(keyFn){return new UniqueSequence(this,keyFn)},Sequence.prototype.unique=function(keyFn){return this.uniq(keyFn)},UniqueSequence.prototype=new Sequence,UniqueSequence.prototype.each=function(fn){var cache=new Set,keyFn=this.keyFn,i=0;return keyFn?(keyFn=createCallback(keyFn),this.parent.each(function(e){return cache.add(keyFn(e))?fn(e,i++):void 0})):this.parent.each(function(e){return cache.add(e)?fn(e,i++):void 0})},Sequence.prototype.zip=function(var_args){return 1===arguments.length?new SimpleZippedSequence(this,var_args):new ZippedSequence(this,arraySlice.call(arguments,0))},ZippedSequence.prototype=new Sequence,ZippedSequence.prototype.each=function(fn){var arrays=this.arrays,i=0;this.parent.each(function(e){for(var group=[e],j=0;j<arrays.length;++j)arrays[j].length>i&&group.push(arrays[j][i]);return fn(group,i++)})},Sequence.prototype.shuffle=function(){return new ShuffledSequence(this)},ShuffledSequence.prototype=new Sequence,ShuffledSequence.prototype.each=function(fn){for(var shuffled=this.parent.toArray(),floor=Math.floor,random=Math.random,j=0,i=shuffled.length-1;i>0;--i)if(swap(shuffled,i,floor(random()*i)+1),fn(shuffled[i],j++)===!1)return;fn(shuffled[0],j)},Sequence.prototype.flatten=function(){return new FlattenedSequence(this)},FlattenedSequence.prototype=new Sequence,FlattenedSequence.prototype.each=function(fn){var index=0;return this.parent.each(function recurseVisitor(e){return e instanceof Array?forEach(e,recurseVisitor):e instanceof Sequence?e.each(recurseVisitor):fn(e,index++)})},Sequence.prototype.compact=function(){return this.filter(function(e){return!!e})},Sequence.prototype.without=function(var_args){return new WithoutSequence(this,arraySlice.call(arguments,0))},Sequence.prototype.difference=function(var_args){return this.without.apply(this,arguments)},WithoutSequence.prototype=new Sequence,WithoutSequence.prototype.each=function(fn){var set=createSet(this.values),i=0;return this.parent.each(function(e){return set.contains(e)?void 0:fn(e,i++)})},Sequence.prototype.union=function(var_args){return this.concat(var_args).uniq()},Sequence.prototype.intersection=function(var_args){return 1===arguments.length&&arguments[0]instanceof Array?new SimpleIntersectionSequence(this,var_args):new IntersectionSequence(this,arraySlice.call(arguments,0))},IntersectionSequence.prototype=new Sequence,IntersectionSequence.prototype.each=function(fn){var sets=Lazy(this.arrays).map(function(values){return new UniqueMemoizer(Lazy(values).getIterator())}),setIterator=new UniqueMemoizer(sets.getIterator()),i=0;return this.parent.each(function(e){var includedInAll=!0;return setIterator.each(function(set){return set.contains(e)?void 0:(includedInAll=!1,!1)}),includedInAll?fn(e,i++):void 0})},UniqueMemoizer.prototype.current=function(){return this.currentValue},UniqueMemoizer.prototype.moveNext=function(){for(var current,iterator=this.iterator,set=this.set,memo=this.memo;iterator.moveNext();)if(current=iterator.current(),set.add(current))return memo.push(current),this.currentValue=current,!0;return!1},UniqueMemoizer.prototype.each=function(fn){for(var memo=this.memo,length=memo.length,i=-1;++i<length;)if(fn(memo[i],i)===!1)return!1;for(;this.moveNext()&&fn(this.currentValue,i++)!==!1;);},UniqueMemoizer.prototype.contains=function(e){if(this.set.contains(e))return!0;for(;this.moveNext();)if(this.currentValue===e)return!0;return!1},Sequence.prototype.every=function(predicate){return predicate=createCallback(predicate),this.each(function(e,i){return!!predicate(e,i)})},Sequence.prototype.all=function(predicate){return this.every(predicate)},Sequence.prototype.some=function(predicate){predicate=createCallback(predicate,!0);var success=!1;return this.each(function(e){return predicate(e)?(success=!0,!1):void 0}),success},Sequence.prototype.any=function(predicate){return this.some(predicate)},Sequence.prototype.none=function(predicate){return!this.any(predicate)},Sequence.prototype.isEmpty=function(){return!this.any()},Sequence.prototype.indexOf=function(value){var foundIndex=-1;return this.each(function(e,i){return e===value?(foundIndex=i,!1):void 0}),foundIndex},Sequence.prototype.lastIndexOf=function(value){var index=this.reverse().indexOf(value);return-1!==index&&(index=this.getIndex().length()-index-1),index},Sequence.prototype.sortedIndex=function(value){for(var i,indexed=this.getIndex(),lower=0,upper=indexed.length();upper>lower;)i=lower+upper>>>1,-1===compare(indexed.get(i),value)?lower=i+1:upper=i;return lower},Sequence.prototype.contains=function(value){return-1!==this.indexOf(value)},Sequence.prototype.reduce=function(aggregator,memo){return arguments.length<2?this.tail().reduce(aggregator,this.head()):(this.each(function(e,i){memo=aggregator(memo,e,i)}),memo)},Sequence.prototype.inject=Sequence.prototype.foldl=function(aggregator,memo){return this.reduce(aggregator,memo)},Sequence.prototype.reduceRight=function(aggregator,memo){if(arguments.length<2)return this.initial(1).reduceRight(aggregator,this.last());var i=this.getIndex().length()-1;return this.reverse().reduce(function(m,e){return aggregator(m,e,i--)},memo)},Sequence.prototype.foldr=function(aggregator,memo){return this.reduceRight(aggregator,memo)},Sequence.prototype.consecutive=function(count){var queue=new Queue(count),segments=this.map(function(element){return queue.add(element).count===count?queue.toArray():void 0});return segments.compact()},Sequence.prototype.chunk=function(size){if(1>size)throw"You must specify a positive chunk size.";return new ChunkedSequence(this,size)},ChunkedSequence.prototype=new Sequence,ChunkedSequence.prototype.getIterator=function(){return new ChunkedIterator(this.parent,this.chunkSize)},ChunkedIterator.prototype.current=function(){return this.currentChunk},ChunkedIterator.prototype.moveNext=function(){for(var iterator=this.iterator,chunkSize=this.size,chunk=[];chunk.length<chunkSize&&iterator.moveNext();)chunk.push(iterator.current());return 0===chunk.length?!1:(this.currentChunk=chunk,!0)},Sequence.prototype.tap=function(callback){return new TappedSequence(this,callback)},TappedSequence.prototype=new Sequence,TappedSequence.prototype.each=function(fn){var callback=this.callback;return this.parent.each(function(e,i){return callback(e,i),fn(e,i)})},Sequence.prototype.find=function(predicate){return this.filter(predicate).first()},Sequence.prototype.detect=function(predicate){return this.find(predicate)},Sequence.prototype.min=function(valueFn){return"undefined"!=typeof valueFn?this.minBy(valueFn):this.reduce(function(x,y){return x>y?y:x},1/0)},Sequence.prototype.minBy=function(valueFn){return valueFn=createCallback(valueFn),this.reduce(function(x,y){return valueFn(y)<valueFn(x)?y:x})},Sequence.prototype.max=function(valueFn){return"undefined"!=typeof valueFn?this.maxBy(valueFn):this.reduce(function(x,y){return y>x?y:x},-(1/0))},Sequence.prototype.maxBy=function(valueFn){return valueFn=createCallback(valueFn),this.reduce(function(x,y){return valueFn(y)>valueFn(x)?y:x})},Sequence.prototype.sum=function(valueFn){return"undefined"!=typeof valueFn?this.sumBy(valueFn):this.reduce(function(x,y){return x+y},0)},Sequence.prototype.sumBy=function(valueFn){return valueFn=createCallback(valueFn),this.reduce(function(x,y){return x+valueFn(y)},0)},Sequence.prototype.join=function(delimiter){return delimiter="string"==typeof delimiter?delimiter:",",this.reduce(function(str,e){return str.length>0&&(str+=delimiter),str+e},"")},Sequence.prototype.toString=function(delimiter){return this.join(delimiter)},Sequence.prototype.async=function(interval){return new AsyncSequence(this,interval)},SimpleIntersectionSequence.prototype=new Sequence,SimpleIntersectionSequence.prototype.eachMemoizerCache=function(fn){var iterator=new UniqueMemoizer(Lazy(this.array).getIterator()),i=0;return this.parent.each(function(e){return iterator.contains(e)?fn(e,i++):void 0})},SimpleIntersectionSequence.prototype.eachArrayCache=function(fn){var array=this.array,find=arrayContains,i=0;return this.parent.each(function(e){return find(array,e)?fn(e,i++):void 0})},SimpleZippedSequence.prototype=new Sequence,SimpleZippedSequence.prototype.each=function(fn){var array=this.array;return this.parent.each(function(e,i){return fn([e,array[i]],i)})},ArrayLikeSequence.prototype=new Sequence,ArrayLikeSequence.define=function(methodName,overrides){if(!overrides||"function"!=typeof overrides.get)throw"A custom array-like sequence must implement *at least* get!";return defineSequenceType(ArrayLikeSequence,methodName,overrides)},ArrayLikeSequence.prototype.get=function(i){return this.parent.get(i)},ArrayLikeSequence.prototype.length=function(){return this.parent.length()},ArrayLikeSequence.prototype.getIndex=function(){return this},ArrayLikeSequence.prototype.getIterator=function(){return new IndexedIterator(this)},IndexedIterator.prototype.current=function(){return this.sequence.get(this.index)},IndexedIterator.prototype.moveNext=function(){return this.index>=this.sequence.length()-1?!1:(++this.index,!0)},ArrayLikeSequence.prototype.each=function(fn){for(var length=this.length(),i=-1;++i<length;)if(fn(this.get(i),i)===!1)return!1;return!0},ArrayLikeSequence.prototype.pop=function(){return this.initial()},ArrayLikeSequence.prototype.shift=function(){return this.drop()},ArrayLikeSequence.prototype.slice=function(begin,end){var length=this.length();0>begin&&(begin=length+begin);var result=this.drop(begin);return"number"==typeof end&&(0>end&&(end=length+end),result=result.take(end-begin)),result},ArrayLikeSequence.prototype.map=function(mapFn){return new IndexedMappedSequence(this,createCallback(mapFn))},IndexedMappedSequence.prototype=new ArrayLikeSequence,IndexedMappedSequence.prototype.get=function(i){return 0>i||i>=this.parent.length()?void 0:this.mapFn(this.parent.get(i),i)},ArrayLikeSequence.prototype.filter=function(filterFn){return new IndexedFilteredSequence(this,createCallback(filterFn))},IndexedFilteredSequence.prototype=new FilteredSequence,IndexedFilteredSequence.prototype.each=function(fn){for(var e,parent=this.parent,filterFn=this.filterFn,length=this.parent.length(),i=-1;++i<length;)if(e=parent.get(i),filterFn(e,i)&&fn(e,i)===!1)return!1;return!0},ArrayLikeSequence.prototype.reverse=function(){return new IndexedReversedSequence(this)},IndexedReversedSequence.prototype=new ArrayLikeSequence,IndexedReversedSequence.prototype.get=function(i){return this.parent.get(this.length()-i-1)},ArrayLikeSequence.prototype.first=function(count){return"undefined"==typeof count?this.get(0):new IndexedTakeSequence(this,count)},IndexedTakeSequence.prototype=new ArrayLikeSequence,IndexedTakeSequence.prototype.length=function(){var parentLength=this.parent.length();return this.count<=parentLength?this.count:parentLength},ArrayLikeSequence.prototype.rest=function(count){return new IndexedDropSequence(this,count)},IndexedDropSequence.prototype=new ArrayLikeSequence,IndexedDropSequence.prototype.get=function(i){return this.parent.get(this.count+i)},IndexedDropSequence.prototype.length=function(){var parentLength=this.parent.length();return this.count<=parentLength?parentLength-this.count:0},ArrayLikeSequence.prototype.concat=function(var_args){return 1===arguments.length&&arguments[0]instanceof Array?new IndexedConcatenatedSequence(this,var_args):Sequence.prototype.concat.apply(this,arguments)},IndexedConcatenatedSequence.prototype=new ArrayLikeSequence,IndexedConcatenatedSequence.prototype.get=function(i){var parentLength=this.parent.length();return parentLength>i?this.parent.get(i):this.other[i-parentLength]},IndexedConcatenatedSequence.prototype.length=function(){return this.parent.length()+this.other.length},ArrayLikeSequence.prototype.uniq=function(keyFn){return new IndexedUniqueSequence(this,createCallback(keyFn))},IndexedUniqueSequence.prototype=new Sequence,IndexedUniqueSequence.prototype.eachArrayCache=function(fn){for(var key,value,parent=this.parent,keyFn=this.keyFn,length=parent.length(),cache=[],find=arrayContains,i=-1,j=0;++i<length;)if(value=parent.get(i),key=keyFn(value),!find(cache,key)&&(cache.push(key),fn(value,j++)===!1))return!1},IndexedUniqueSequence.prototype.eachSetCache=UniqueSequence.prototype.each,MemoizedSequence.prototype=new ArrayLikeSequence,MemoizedSequence.prototype.cache=function(){return this.cachedResult||(this.cachedResult=this.parent.toArray())},MemoizedSequence.prototype.get=function(i){return this.cache()[i]},MemoizedSequence.prototype.length=function(){return this.cache().length},MemoizedSequence.prototype.slice=function(begin,end){return this.cache().slice(begin,end)},MemoizedSequence.prototype.toArray=function(){return this.cache().slice(0)},ArrayWrapper.prototype=new ArrayLikeSequence,ArrayWrapper.prototype.root=function(){return this},ArrayWrapper.prototype.get=function(i){return this.source[i]},ArrayWrapper.prototype.length=function(){return this.source.length},ArrayWrapper.prototype.each=function(fn){return forEach(this.source,fn)},ArrayWrapper.prototype.map=ArrayWrapper.prototype.collect=function(mapFn){return new MappedArrayWrapper(this,createCallback(mapFn))},ArrayWrapper.prototype.filter=ArrayWrapper.prototype.select=function(filterFn){return new FilteredArrayWrapper(this,createCallback(filterFn))},ArrayWrapper.prototype.uniq=ArrayWrapper.prototype.unique=function(keyFn){return new UniqueArrayWrapper(this,keyFn)},ArrayWrapper.prototype.concat=function(var_args){return 1===arguments.length&&arguments[0]instanceof Array?new ConcatArrayWrapper(this,var_args):ArrayLikeSequence.prototype.concat.apply(this,arguments)},ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)},MappedArrayWrapper.prototype=new ArrayLikeSequence,MappedArrayWrapper.prototype.get=function(i){var source=this.parent.source;return 0>i||i>=source.length?void 0:this.mapFn(source[i])},MappedArrayWrapper.prototype.length=function(){return this.parent.source.length},MappedArrayWrapper.prototype.each=function(fn){for(var source=this.parent.source,length=source.length,mapFn=this.mapFn,i=-1;++i<length;)if(fn(mapFn(source[i],i),i)===!1)return!1;return!0},FilteredArrayWrapper.prototype=new FilteredSequence,FilteredArrayWrapper.prototype.each=function(fn){for(var e,source=this.parent.source,filterFn=this.filterFn,length=source.length,i=-1;++i<length;)if(e=source[i],filterFn(e,i)&&fn(e,i)===!1)return!1;return!0},UniqueArrayWrapper.prototype=new Sequence,UniqueArrayWrapper.prototype.eachNoCache=function(fn){for(var value,source=this.parent.source,keyFn=this.keyFn,length=source.length,find=arrayContainsBefore,i=-1,k=0;++i<length;)if(value=source[i],!find(source,value,i,keyFn)&&fn(value,k++)===!1)return!1;return!0},UniqueArrayWrapper.prototype.eachArrayCache=function(fn){var key,value,source=this.parent.source,keyFn=this.keyFn,length=source.length,cache=[],find=arrayContains,i=-1,j=0;if(keyFn){for(keyFn=createCallback(keyFn);++i<length;)if(value=source[i],
key=keyFn(value),!find(cache,key)&&(cache.push(key),fn(value,j++)===!1))return!1}else for(;++i<length;)if(value=source[i],!find(cache,value)&&(cache.push(value),fn(value,j++)===!1))return!1;return!0},UniqueArrayWrapper.prototype.eachSetCache=UniqueSequence.prototype.each,ConcatArrayWrapper.prototype=new ArrayLikeSequence,ConcatArrayWrapper.prototype.get=function(i){var source=this.parent.source,sourceLength=source.length;return sourceLength>i?source[i]:this.other[i-sourceLength]},ConcatArrayWrapper.prototype.length=function(){return this.parent.source.length+this.other.length},ConcatArrayWrapper.prototype.each=function(fn){for(var source=this.parent.source,sourceLength=source.length,other=this.other,otherLength=other.length,i=0,j=-1;++j<sourceLength;)if(fn(source[j],i++)===!1)return!1;for(j=-1;++j<otherLength;)if(fn(other[j],i++)===!1)return!1;return!0},ObjectLikeSequence.prototype=new Sequence,ObjectLikeSequence.define=function(methodName,overrides){if(!overrides||"function"!=typeof overrides.each)throw"A custom object-like sequence must implement *at least* each!";return defineSequenceType(ObjectLikeSequence,methodName,overrides)},ObjectLikeSequence.prototype.value=function(){return this.toObject()},ObjectLikeSequence.prototype.get=function(key){var pair=this.pairs().find(function(pair){return pair[0]===key});return pair?pair[1]:void 0},ObjectLikeSequence.prototype.keys=function(){return this.map(function(v,k){return k})},ObjectLikeSequence.prototype.values=function(){return this.map(function(v,k){return v})},ObjectLikeSequence.prototype.async=function(){throw"An ObjectLikeSequence does not support asynchronous iteration."},ObjectLikeSequence.prototype.reverse=function(){return this},ObjectLikeSequence.prototype.assign=function(other){return new AssignSequence(this,other)},ObjectLikeSequence.prototype.extend=function(other){return this.assign(other)},AssignSequence.prototype=new ObjectLikeSequence,AssignSequence.prototype.get=function(key){return this.other[key]||this.parent.get(key)},AssignSequence.prototype.each=function(fn){var merged=new Set,done=!1;return Lazy(this.other).each(function(value,key){return fn(value,key)===!1?(done=!0,!1):void merged.add(key)}),done?void 0:this.parent.each(function(value,key){return merged.contains(key)||fn(value,key)!==!1?void 0:!1})},ObjectLikeSequence.prototype.defaults=function defaults(defaults){return new DefaultsSequence(this,defaults)},DefaultsSequence.prototype=new ObjectLikeSequence,DefaultsSequence.prototype.get=function(key){return this.parent.get(key)||this.defaults[key]},DefaultsSequence.prototype.each=function(fn){var merged=new Set,done=!1;this.parent.each(function(value,key){return fn(value,key)===!1?(done=!0,!1):void("undefined"!=typeof value&&merged.add(key))}),done||Lazy(this.defaults).each(function(value,key){return merged.contains(key)||fn(value,key)!==!1?void 0:!1})},ObjectLikeSequence.prototype.invert=function(){return new InvertedSequence(this)},InvertedSequence.prototype=new ObjectLikeSequence,InvertedSequence.prototype.each=function(fn){this.parent.each(function(value,key){return fn(key,value)})},ObjectLikeSequence.prototype.merge=function(var_args){var mergeFn=arguments.length>1&&"function"==typeof arguments[arguments.length-1]?arrayPop.call(arguments):null;return new MergedSequence(this,arraySlice.call(arguments,0),mergeFn)},MergedSequence.prototype=new ObjectLikeSequence,MergedSequence.prototype.each=function(fn){var others=this.others,mergeFn=this.mergeFn||mergeObjects,keys={},iteratedFullSource=this.parent.each(function(value,key){var merged=value;return forEach(others,function(other){key in other&&(merged=mergeFn(merged,other[key]))}),keys[key]=!0,fn(merged,key)});if(iteratedFullSource===!1)return!1;var remaining={};return forEach(others,function(other){for(var k in other)keys[k]||(remaining[k]=mergeFn(remaining[k],other[k]))}),Lazy(remaining).each(fn)},ObjectLikeSequence.prototype.functions=function(){return this.filter(function(v,k){return"function"==typeof v}).map(function(v,k){return k})},ObjectLikeSequence.prototype.methods=function(){return this.functions()},ObjectLikeSequence.prototype.pick=function(properties){return new PickSequence(this,properties)},PickSequence.prototype=new ObjectLikeSequence,PickSequence.prototype.get=function(key){return arrayContains(this.properties,key)?this.parent.get(key):void 0},PickSequence.prototype.each=function(fn){var inArray=arrayContains,properties=this.properties;return this.parent.each(function(value,key){return inArray(properties,key)?fn(value,key):void 0})},ObjectLikeSequence.prototype.omit=function(properties){return new OmitSequence(this,properties)},OmitSequence.prototype=new ObjectLikeSequence,OmitSequence.prototype.get=function(key){return arrayContains(this.properties,key)?void 0:this.parent.get(key)},OmitSequence.prototype.each=function(fn){var inArray=arrayContains,properties=this.properties;return this.parent.each(function(value,key){return inArray(properties,key)?void 0:fn(value,key)})},ObjectLikeSequence.prototype.pairs=function(){return this.map(function(v,k){return[k,v]})},ObjectLikeSequence.prototype.toArray=function(){return this.pairs().toArray()},ObjectLikeSequence.prototype.toObject=function(){return this.reduce(function(object,value,key){return object[key]=value,object},{})},GroupedSequence.prototype=new ObjectLikeSequence,GroupedSequence.prototype.each=function(fn){var keyFn=createCallback(this.keyFn),grouped={};this.parent.each(function(e){var key=keyFn(e);grouped[key]?grouped[key].push(e):grouped[key]=[e]});for(var key in grouped)if(fn(grouped[key],key)===!1)return!1;return!0},CountedSequence.prototype=new ObjectLikeSequence,CountedSequence.prototype.each=function(fn){var keyFn=createCallback(this.keyFn),counted={};this.parent.each(function(e){var key=keyFn(e);counted[key]?counted[key]+=1:counted[key]=1});for(var key in counted)if(fn(counted[key],key)===!1)return!1;return!0},ObjectLikeSequence.prototype.watch=function(propertyNames){throw"You can only call #watch on a directly wrapped object."},ObjectWrapper.prototype=new ObjectLikeSequence,ObjectWrapper.prototype.root=function(){return this},ObjectWrapper.prototype.get=function(key){return this.source[key]},ObjectWrapper.prototype.each=function(fn){var key,source=this.source;for(key in source)if(fn(source[key],key)===!1)return!1;return!0},StringLikeSequence.prototype=new ArrayLikeSequence,StringLikeSequence.define=function(methodName,overrides){if(!overrides||"function"!=typeof overrides.get)throw"A custom string-like sequence must implement *at least* get!";return defineSequenceType(StringLikeSequence,methodName,overrides)},StringLikeSequence.prototype.value=function(){return this.toString()},StringLikeSequence.prototype.getIterator=function(){return new CharIterator(this)},CharIterator.prototype.current=function(){return this.source.charAt(this.index)},CharIterator.prototype.moveNext=function(){return++this.index<this.source.length()},StringLikeSequence.prototype.charAt=function(i){return this.get(i)},StringLikeSequence.prototype.charCodeAt=function(i){var char=this.charAt(i);return char?char.charCodeAt(0):NaN},StringLikeSequence.prototype.substring=function(start,stop){return new StringSegment(this,start,stop)},StringSegment.prototype=new StringLikeSequence,StringSegment.prototype.get=function(i){return this.parent.get(i+this.start)},StringSegment.prototype.length=function(){return("number"==typeof this.stop?this.stop:this.parent.length())-this.start},StringLikeSequence.prototype.first=function(count){return"undefined"==typeof count?this.charAt(0):this.substring(0,count)},StringLikeSequence.prototype.last=function(count){return"undefined"==typeof count?this.charAt(this.length()-1):this.substring(this.length()-count)},StringLikeSequence.prototype.drop=function(count){return this.substring(count)},StringLikeSequence.prototype.indexOf=function(substring,startIndex){return this.toString().indexOf(substring,startIndex)},StringLikeSequence.prototype.lastIndexOf=function(substring,startIndex){return this.toString().lastIndexOf(substring,startIndex)},StringLikeSequence.prototype.contains=function(substring){return-1!==this.indexOf(substring)},StringLikeSequence.prototype.endsWith=function(suffix){return this.substring(this.length()-suffix.length).toString()===suffix},StringLikeSequence.prototype.startsWith=function(prefix){return this.substring(0,prefix.length).toString()===prefix},StringLikeSequence.prototype.toUpperCase=function(){return this.mapString(function(char){return char.toUpperCase()})},StringLikeSequence.prototype.toLowerCase=function(){return this.mapString(function(char){return char.toLowerCase()})},StringLikeSequence.prototype.mapString=function(mapFn){return new MappedStringLikeSequence(this,mapFn)},MappedStringLikeSequence.prototype=new StringLikeSequence,MappedStringLikeSequence.prototype.get=IndexedMappedSequence.prototype.get,MappedStringLikeSequence.prototype.length=IndexedMappedSequence.prototype.length,StringLikeSequence.prototype.reverse=function(){return new ReversedStringLikeSequence(this)},ReversedStringLikeSequence.prototype=new StringLikeSequence,ReversedStringLikeSequence.prototype.get=IndexedReversedSequence.prototype.get,ReversedStringLikeSequence.prototype.length=IndexedReversedSequence.prototype.length,StringLikeSequence.prototype.toString=function(){return this.join("")},StringLikeSequence.prototype.match=function(pattern){return new StringMatchSequence(this.source,pattern)},StringMatchSequence.prototype=new Sequence,StringMatchSequence.prototype.getIterator=function(){return new StringMatchIterator(this.source,this.pattern)},StringMatchIterator.prototype.current=function(){return this.match[0]},StringMatchIterator.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))},StringLikeSequence.prototype.split=function(delimiter){return new SplitStringSequence(this.source,delimiter)},SplitStringSequence.prototype=new Sequence,SplitStringSequence.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new CharIterator(this.source):new SplitWithRegExpIterator(this.source,this.pattern):""===this.pattern?new CharIterator(this.source):new SplitWithStringIterator(this.source,this.pattern)},SplitWithRegExpIterator.prototype.current=function(){return this.source.substring(this.start,this.end)},SplitWithRegExpIterator.prototype.moveNext=function(){if(!this.pattern)return!1;var match=this.pattern.exec(this.source);return match?(this.start=this.nextStart?this.nextStart:0,this.end=match.index,this.nextStart=match.index+match[0].length,!0):this.pattern?(this.start=this.nextStart,this.end=void 0,this.nextStart=void 0,this.pattern=void 0,!0):!1},SplitWithStringIterator.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)},SplitWithStringIterator.prototype.moveNext=function(){return this.finished||(this.leftIndex="undefined"!=typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex)),-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished},StringWrapper.prototype=new StringLikeSequence,StringWrapper.prototype.root=function(){return this},StringWrapper.prototype.get=function(i){return this.source.charAt(i)},StringWrapper.prototype.length=function(){return this.source.length},GeneratedSequence.prototype=new Sequence,GeneratedSequence.prototype.length=function(){return this.fixedLength},GeneratedSequence.prototype.each=function(fn){for(var generatorFn=this.get,length=this.fixedLength,i=0;"undefined"==typeof length||length>i;)if(fn(generatorFn(i++))===!1)return!1;return!0},GeneratedSequence.prototype.getIterator=function(){return new GeneratedIterator(this)},GeneratedIterator.prototype.current=function(){return this.currentValue},GeneratedIterator.prototype.moveNext=function(){var sequence=this.sequence;return"number"==typeof sequence.fixedLength&&this.index>=sequence.fixedLength?!1:(this.currentValue=sequence.get(this.index++),!0)},AsyncSequence.prototype=new Sequence,AsyncSequence.prototype.getIterator=function(){throw"An AsyncSequence does not support synchronous iteration."},AsyncSequence.prototype.each=function(fn){var iterator=this.parent.getIterator(),onNextCallback=this.onNextCallback,i=0,handle=new AsyncHandle(this.interval);return handle.id=onNextCallback(function iterate(){try{iterator.moveNext()&&fn(iterator.current(),i++)!==!1?handle.id=onNextCallback(iterate):handle.completeCallback()}catch(e){handle.errorCallback(e)}}),handle},AsyncHandle.prototype.cancel=function(){var cancelCallback=this.cancelCallback;this.id&&(cancelCallback(this.id),this.id=null)},AsyncHandle.prototype.onError=function(callback){this.errorCallback=callback},AsyncHandle.prototype.errorCallback=Lazy.noop,AsyncHandle.prototype.onComplete=function(callback){this.completeCallback=callback},AsyncHandle.prototype.completeCallback=Lazy.noop,AsyncSequence.prototype.reverse=function(){return this.parent.reverse().async()},AsyncSequence.prototype.reduce=function(aggregator,memo){var handle=this.each(function(e,i){memo="undefined"==typeof memo&&0===i?e:aggregator(memo,e,i)});return handle.then=handle.onComplete=function(callback){handle.completeCallback=function(){callback(memo)}},handle},AsyncSequence.prototype.find=function(predicate){var found,handle=this.each(function(e,i){return predicate(e,i)?(found=e,!1):void 0});return handle.then=handle.onComplete=function(callback){handle.completeCallback=function(){callback(found)}},handle},AsyncSequence.prototype.indexOf=function(value){var foundIndex=-1,handle=this.each(function(e,i){return e===value?(foundIndex=i,!1):void 0});return handle.then=handle.onComplete=function(callback){handle.completeCallback=function(){callback(foundIndex)}},handle},AsyncSequence.prototype.contains=function(value){var found=!1,handle=this.each(function(e){return e===value?(found=!0,!1):void 0});return handle.then=handle.onComplete=function(callback){handle.completeCallback=function(){callback(found)}},handle},AsyncSequence.prototype.async=function(){return this},ObjectWrapper.prototype.watch=function(propertyNames){return new WatchedPropertySequence(this.source,propertyNames)},WatchedPropertySequence.prototype=new AsyncSequence,WatchedPropertySequence.prototype.each=function(fn){this.listeners.push(fn)},StreamLikeSequence.prototype=new AsyncSequence,StreamLikeSequence.prototype.split=function(delimiter){return new SplitStreamSequence(this,delimiter)},SplitStreamSequence.prototype=new Sequence,SplitStreamSequence.prototype.each=function(fn){var delimiter=this.delimiter,done=!1,i=0;return this.parent.each(function(chunk){return Lazy(chunk).split(delimiter).each(function(piece){return fn(piece,i++)===!1?(done=!0,!1):void 0}),!done})},StreamLikeSequence.prototype.lines=function(){return this.split("\n")},StreamLikeSequence.prototype.match=function(pattern){return new MatchedStreamSequence(this,pattern)},MatchedStreamSequence.prototype=new AsyncSequence,MatchedStreamSequence.prototype.each=function(fn){var pattern=this.pattern,done=!1,i=0;return this.parent.each(function(chunk){return Lazy(chunk).match(pattern).each(function(match){return fn(match,i++)===!1?(done=!0,!1):void 0}),!done})},Lazy.createWrapper=function(initializer){var ctor=function(){this.listeners=[]};return ctor.prototype=new StreamLikeSequence,ctor.prototype.each=function(listener){this.listeners.push(listener)},ctor.prototype.emit=function(data){for(var listeners=this.listeners,len=listeners.length,i=len-1;i>=0;--i)listeners[i](data)===!1&&listeners.splice(i,1)},function(){var sequence=new ctor;return initializer.apply(sequence,arguments),sequence}},Lazy.generate=function(generatorFn,length){return new GeneratedSequence(generatorFn,length)},Lazy.range=function(){var start=arguments.length>1?arguments[0]:0,stop=arguments.length>1?arguments[1]:arguments[0],step=arguments.length>2?arguments[2]:1;return this.generate(function(i){return start+step*i}).take(Math.floor((stop-start)/step))},Lazy.repeat=function(value,count){return Lazy.generate(function(){return value},count)},Lazy.Sequence=Sequence,Lazy.ArrayLikeSequence=ArrayLikeSequence,Lazy.ObjectLikeSequence=ObjectLikeSequence,Lazy.StringLikeSequence=StringLikeSequence,Lazy.StreamLikeSequence=StreamLikeSequence,Lazy.GeneratedSequence=GeneratedSequence,Lazy.AsyncSequence=AsyncSequence,Lazy.AsyncHandle=AsyncHandle,Lazy.deprecate=function(message,fn){return function(){return fn.apply(this,arguments)}};var arrayPop=Array.prototype.pop,arraySlice=Array.prototype.slice;Set.prototype.add=function(value){var objects,table=this.table,type=typeof value;switch(type){case"number":case"boolean":case"undefined":return table[value]?!1:(table[value]=!0,!0);case"string":switch(value.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":value="@"+value}return table[value]?!1:(table[value]=!0,!0);default:return objects=this.objects,arrayContains(objects,value)?!1:(objects.push(value),!0)}},Set.prototype.contains=function(value){var type=typeof value;switch(type){case"number":case"boolean":case"undefined":return!!this.table[value];case"string":switch(value.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":value="@"+value}return!!this.table[value];default:return arrayContains(this.objects,value)}},Queue.prototype.add=function(element){var contents=this.contents,capacity=contents.length,start=this.start;return this.count===capacity?(contents[start]=element,this.start=(start+1)%capacity):contents[this.count++]=element,this},Queue.prototype.toArray=function(){var contents=this.contents,start=this.start,count=this.count,snapshot=contents.slice(start,start+count);return snapshot.length<count&&(snapshot=snapshot.concat(contents.slice(0,count-snapshot.length))),snapshot},"object"==typeof module&&module&&module.exports===context?module.exports=Lazy:context.Lazy=Lazy}(this),function(self){self.JSOL||(self.JSOL={});var trim=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;"function"!=typeof self.JSOL.parse&&(self.JSOL.parse=function(inText){var text=inText.replace(/\n/,"");if("string"!=typeof text||!text)return null;if(text=text.replace(trim,""),text=text.replace(/'/g,'"'),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,":").replace(/\w*\s*\:/g,":")))return new Function("return "+text)();throw"Invalid JSOL: "+text})}(window),angular.module("services.templateRetriever",[]).factory("templateRetriever",["$http","$q",function($http,$q){return{getTemplate:function(templateUrl,tracker){var deferred=$q.defer();return $http({url:templateUrl,method:"GET",headers:{"Content-Type":"text/html"},tracker:tracker||"promiseTracker"}).success(function(data){deferred.resolve(data)}).error(function(data,status,headers,config){deferred.reject({data:data,status:status,headers:headers,config:config})}),deferred.promise}}}]),angular_ui_form_validations=function(){var customValidations,createValidationFormatterLink,customValidationsModule,getValidationPriorityIndex,getValidationAttributeValue,getValidatorByAttribute,getCustomTemplateIfDefined,customTemplates,isCurrentlyDisplayingAnErrorMessageInATemplate,currentlyDisplayedTemplate,dynamicallyDefinedValidation,$q,$timeout,$log;customTemplates=[],customValidations=[];var submitLink=function($scope,$element,$attrs,ngModelController){if("undefined"!=typeof $attrs.validationSubmit){var validationSubmit=getValidationAttributeValue($attrs.validationSubmit,"onSubmit",!0),formName=getValidationAttributeValue($attrs.validationSubmit,"formName",!0),form=angular.element("[name="+formName+"]");0===form.length&&(form=$element.parents("[name="+formName+"]")),validationSubmit=validationSubmit.substring(0,validationSubmit.indexOf("("));var submitFunction=$scope[validationSubmit],indexOfDot=validationSubmit.indexOf(".");if(-1!==indexOfDot){var model=validationSubmit.substring(0,indexOfDot),modelFunction=validationSubmit.substring(indexOfDot+1);submitFunction=$scope[model][modelFunction]}var formIsValid=!1;$element.addClass("invalid"),$element.removeClass("valid");var formIsSubmittable=function(){formIsValid=!0,$element.addClass("valid"),$element.removeClass("invalid")},formIsNotSubmittable=function(){formIsValid=!1,$element.addClass("invalid"),$element.removeClass("valid")},formValidityChangeListener=function(currentValidValue,previousValidValue){var valid=currentValidValue;valid===!0?formIsSubmittable():formIsNotSubmittable()},isFormValid=function(scope){var valid=!1,hasMissingRequiredField=!1,fields=form.children("input, select");if(fields.each(function(index,field){""===field.value.trim()&&"true"===$(field).attr("validation-field-required")&&(hasMissingRequiredField=!0)}),hasMissingRequiredField===!0)return!1;var numTotalFields=fields.length,numValidatedFields=form.children(".ValidationLiveSuccess").length;return numTotalFields-numValidatedFields===0&&(valid=!0),valid};$scope.$watch(function(scope){return isFormValid(scope)},function(valid){valid===!0?formIsSubmittable():formIsNotSubmittable()}),$element.on("click",function(){formIsValid===!0&&submitFunction.apply($scope,[])}),formValidityChangeListener(isFormValid($scope))}};return dynamicallyDefinedValidation={customValidationAttribute:"validationDynamicallyDefined",errorCount:0,latestElement:null,_errorMessage:"Field is invalid",_success:function(){},success:function(){return dynamicallyDefinedValidation._success&&dynamicallyDefinedValidation._success.apply(this,arguments)},errorMessage:function(){return dynamicallyDefinedValidation._errorMessage},validator:function(errorMessageElement,val,attr,element,model,modelCtrl,scope){var valid,hydrateDynamicallyDefinedValidation,scopeValidations,setErrorIdentifier,setValidity,validatorArgs;return validatorArgs=arguments,scopeValidations=scope[attr],hydrateDynamicallyDefinedValidation=function(validation){return dynamicallyDefinedValidation._errorMessage=validation.errorMessage,dynamicallyDefinedValidation._success=validation.success,validation},setErrorIdentifier=function(validation,index){var identifier,clone;return identifier="validationdynamicallydefined",identifier+=validation.identifier&&""!==validation.identifier&&null!==validation.identifier?validation.identifier.charAt(0).toUpperCase()+validation.identifier.slice(1).toLowerCase():index,clone=angular.copy(validation),clone.identifier=identifier,clone},setValidity=function(validation){return valid=validation.validator.apply(scope,validatorArgs),modelCtrl.$setValidity(validation.identifier,valid),valid===!0},Lazy(scopeValidations).map(hydrateDynamicallyDefinedValidation).map(setErrorIdentifier).map(setValidity).each(function(valid){return valid===!1?(dynamicallyDefinedValidation.errorCount++,dynamicallyDefinedValidation.latestElement=element,!1):!0}),valid}},onValidationComplete=function(fieldIsValid,value,validationAttributeValue,$element,model,ngModelController,$scope,customOnSuccess){fieldIsValid?($element.addClass("ValidationLiveSuccess"),$element.addClass($element.attr("validation-live-success-cls")),$element.removeClass($element.attr("validation-live-fail-cls")),customOnSuccess.call(this,value,validationAttributeValue,$element,model,ngModelController,$scope)):($element.removeClass("ValidationLiveSuccess"),$element.removeClass($element.attr("validation-live-success-cls")),$element.addClass($element.attr("validation-live-fail-cls")))},isCurrentlyDisplayingAnErrorMessageInATemplate=function(inputElement){var isCurrentlyDisplayingAnErrorMessageInATemplate=!1;return Lazy(customTemplates).each(function(template){return template.attr("templateUid")===inputElement.attr("templateUid")?(isCurrentlyDisplayingAnErrorMessageInATemplate=!0,currentlyDisplayedTemplate=template,!1):!0}),isCurrentlyDisplayingAnErrorMessageInATemplate},getValidationAttributeValue=function(attr,property,strict){var value;if(void 0===attr)return void 0;property=property||"value",value=attr;try{var json=JSOL.parse(attr)}catch(e){}return null!==json&&"object"==typeof json?(json.hasOwnProperty(property)?(hasProperty=!0,value=json[property]):(hasProperty=!1,value=void 0,strict!==!0&&(value=json.value)),value):strict===!0?void 0:value},getValidationAttributeByPropertyName=function(attr,property){var value;try{value=JSOL.parse(attr)[property]}catch(e){value=null}return value},getCustomTemplateIfDefined=function(attr,templateRetriever){var deferred,templateUrl,promise;deferred=$q.defer(),promise=deferred.promise;try{templateUrl=JSOL.parse(attr).template,void 0===templateUrl||null===templateUrl||""===templateUrl?deferred.reject("No template url specified."):promise=templateRetriever.getTemplate(templateUrl)}catch(e){deferred.reject("Error retrieving custom error template: "+e)}return promise},getValidatorByAttribute=function(customValidationAttribute){var validator;return Lazy(customValidations).each(function(validation){return validation.customValidationAttribute===customValidationAttribute?(validator=validation.validator,!1):!0}),validator},getValidationPriorityIndex=function(customValidationAttribute){var index;return Lazy(customValidations).each(function(validation,i){return validation.customValidationAttribute===customValidationAttribute?(index=i,!1):!0}),index},createValidationFormatterLink=function(formatterArgs,templateRetriever,q,timeout,log){return $q=q,$timeout=timeout,$log=log,function($scope,$element,$attrs,ngModelController){var customErrorMessage,errorMessage,errorMessageElement,modelName,model,propertyName,runCustomValidations,validationAttributeValue,customErrorTemplate;$timeout(function(){var getErrorMessageElement,addWatcherForDynamicallyDefinedValidations,addWatcherToWrapErrorInCustomTemplate,isValidValidationAttributeValue,getFormatterArgsErrorMessage,installErrorMessageElement,installSpecialErrorCases,rawCustomValidationAttribute=$attrs[formatterArgs.customValidationAttribute];validationAttributeValue=getValidationAttributeValue(rawCustomValidationAttribute),isValidValidationAttributeValue=validationAttributeValue&&"undefined"!==validationAttributeValue&&"false"!==validationAttributeValue,getErrorMessageElement=function(){var ifCheckboxOrRadio="";return/checkbox|radio/.test($element[0].type)&&(ifCheckboxOrRadio="checkboxradioerror "),angular.element("<span data-custom-validation-priorityIndex="+getValidationPriorityIndex(formatterArgs.customValidationAttribute)+" data-custom-validation-attribute="+formatterArgs.customValidationAttribute+" data-custom-field-name="+$element.attr("name")+' class="CustomValidationError '+ifCheckboxOrRadio+formatterArgs.customValidationAttribute+" "+propertyName+'property">'+errorMessage+"</span>")},addWatcherForDynamicallyDefinedValidations=function(){$scope.$watch(function(){return dynamicallyDefinedValidation.errorCount},function(){if(0!==dynamicallyDefinedValidation.errorCount){var currentElementFieldName=errorMessageElement.attr("data-custom-field-name"),latestValidatedFieldName=dynamicallyDefinedValidation.latestElement.attr("name");latestValidatedFieldName===currentElementFieldName&&errorMessageElement.html(dynamicallyDefinedValidation.errorMessage())}})},addWatcherToWrapErrorInCustomTemplate=function(template){var errorMessageToggled;customErrorTemplate=angular.element(template),customErrorTemplate.html(""),errorMessageToggled=function(){var templateUid=Math.random();"inline"===errorMessageElement.css("display")||"block"===errorMessageElement.css("display")?($element.attr("templateUid",templateUid),customErrorTemplate.attr("templateUid",templateUid),errorMessageElement.wrap(customErrorTemplate),customTemplates.push(angular.element(errorMessageElement.parents()[0]))):($element.removeAttr("templateUid"),errorMessageElement.parent().is("."+customErrorTemplate.attr("class"))&&errorMessageElement.unwrap(customErrorTemplate))},$scope.$watch(function(){return errorMessageElement.css("display")},errorMessageToggled),$scope.$on("errorMessageToggled",errorMessageToggled)},getFormatterArgsErrorMessage=function(){var errorMessage;return errorMessage="function"==typeof formatterArgs.errorMessage?formatterArgs.errorMessage(validationAttributeValue):formatterArgs.errorMessage},installErrorMessageElement=function(){errorMessage=getFormatterArgsErrorMessage(),errorMessageElement=getErrorMessageElement(),$element.after(errorMessageElement),errorMessageElement.hide(),"validationDynamicallyDefined"===formatterArgs.customValidationAttribute&&addWatcherForDynamicallyDefinedValidations(),getCustomTemplateIfDefined($attrs[formatterArgs.customValidationAttribute],templateRetriever).then(function(template){addWatcherToWrapErrorInCustomTemplate(template)}),customErrorMessage=getValidationAttributeByPropertyName($attrs[formatterArgs.customValidationAttribute],"message"),null!==customErrorMessage&&errorMessageElement.html(customErrorMessage)},installSpecialErrorCases=function(){if("validationNoSpace"===formatterArgs.customValidationAttribute&&$element.keyup(function(event){8===event.keyCode&&(model[propertyName]=$element.val().replace(/\s+$/,""))}),"validationConfirmPassword"===formatterArgs.customValidationAttribute){var passwordFieldId=$element.attr("passwordFieldId")||"password",passwordFieldSelector="#"+passwordFieldId,validationConfirmPasswordHandlerSelector=passwordFieldSelector+", #"+$element[0].id,confirmPasswordElement=$element,passwordElement=$element.parent().children(passwordFieldSelector);return void $($element.parent()).on("keyup blur",validationConfirmPasswordHandlerSelector,function(target){var passwordMatch,confirmPasswordIsDirty;confirmPasswordIsDirty=/dirty/.test(confirmPasswordElement.attr("class")),confirmPasswordIsDirty!==!1&&(passwordMatch=passwordElement.val()===$element.val(),ngModelController.$setValidity("validationconfirmpassword",passwordMatch),confirmPasswordElement.siblings(".CustomValidationError.validationConfirmPassword:first").toggle(!passwordMatch),onValidationComplete(passwordMatch,passwordMatch,validationAttributeValue,$element,model,ngModelController,$scope,function(){formatterArgs.success&&formatterArgs.success()}))})}"validationFieldRequired"===formatterArgs.customValidationAttribute&&$element.parents("form").find("label[for="+$element.attr("id")+"]").addClass("requiredFieldLabel")},runCustomValidations=function(eventType){function getCurrentlyDisplayingErrorMessage(){var fieldNameSelector,selector;return fieldNameSelector='[data-custom-field-name="'+$element.attr("name")+'"]',selector='.CustomValidationError[style="display: inline;"]'+fieldNameSelector+', .CustomValidationError[style="display: block;"]'+fieldNameSelector,isCurrentlyDisplayingAnErrorMessageInATemplate($element)?currentlyDisplayedTemplate.children(selector):$element.siblings(selector)}function getElementValue(){var value=$element.val().replace(/\s+$/,"");return/select/.test($element[0].type)&&(value=$element[0].options[$element[0].selectedIndex].innerHTML),/checkbox|radio/.test($element[0].type)&&(value=$element[0].checked===!0?"true":""),value}function toggleRequiredLabelClass(){""===value?$element.parents("form").find("label[for="+$element.attr("id")+"]").addClass("requiredFieldLabel"):$element.parents("form").find("label[for="+$element.attr("id")+"]").removeClass("requiredFieldLabel")}function runValidation(){return formatterArgs.validator(errorMessageElement,value,validationAttributeValue,$element,model,ngModelController,$scope,rawCustomValidationAttribute)}function getPropertyNameClass(pname){return pname.replace(".","\\.")}function whenIsNotCurrentlyDisplayingAnErrorMessage(){var classNames=".CustomValidationError."+formatterArgs.customValidationAttribute+"."+getPropertyNameClass(propertyName)+"property:first";$element.siblings(classNames).toggle(!isValid)}function whenIsNotCurrentlyDisplayingAnErrorMessageInATemplate(){
currentErrorMessageValidator=getValidatorByAttribute(currentErrorMessage.attr("data-custom-validation-attribute")),currentErrorMessageIsStale=currentErrorMessageValidator(errorMessageElement.clone(),value,$attrs[currentErrorMessage.attr("data-custom-validation-attribute")],$element,model,ngModelController,$scope,rawCustomValidationAttribute),currentErrorMessagePriorityIndex=parseInt(currentErrorMessage.attr("data-custom-validation-priorityIndex"),10),currentErrorMessageIsOfALowerPriority=currentErrorMessagePriorityIndex>=getValidationPriorityIndex(formatterArgs.customValidationAttribute),(currentErrorMessageIsStale||!currentErrorMessageIsStale&&currentErrorMessageIsOfALowerPriority&&!isValid)&&(currentErrorMessage.hide(),$element.siblings(".CustomValidationError."+formatterArgs.customValidationAttribute+"."+getPropertyNameClass(propertyName)+"property:first").toggle(!isValid))}function whenIsCurrentlyDisplayingAnErrorMessageInATemplate(){currentErrorMessageValidator=getValidatorByAttribute(currentErrorMessage.attr("data-custom-validation-attribute")),currentErrorMessageIsStale=currentErrorMessageValidator(errorMessageElement,value,getValidationAttributeValue($attrs[currentErrorMessage.attr("data-custom-validation-attribute")]),$element,model,ngModelController),currentErrorMessagePriorityIndex=parseInt(currentErrorMessage.attr("data-custom-validation-priorityIndex"),10),currentErrorMessageIsOfALowerPriority=currentErrorMessagePriorityIndex>=getValidationPriorityIndex(formatterArgs.customValidationAttribute),(currentErrorMessageIsStale||!currentErrorMessageIsStale&&currentErrorMessageIsOfALowerPriority&&!isValid&&-1===currentlyDisplayedTemplate.children().attr("class").indexOf(formatterArgs.customValidationAttribute))&&(currentErrorMessage.hide(),$element.siblings(".CustomValidationError."+formatterArgs.customValidationAttribute+"."+getPropertyNameClass(propertyName)+"property:first").toggle(!isValid),$scope.$broadcast("errorMessageToggled"))}var isValid,value,customValidationBroadcastArg,currentlyDisplayingAnErrorMessage,currentErrorMessage,currentErrorMessageIsStale,currentErrorMessageValidator,currentErrorMessagePriorityIndex,currentErrorMessageIsOfALowerPriority,successFn,evaluateAsValid=!1;if("blur"!==eventType&&"runCustomValidations"!==eventType&&(formatterArgs.validateWhileEntering&&formatterArgs.validateWhileEntering===!0||(evaluateAsValid=!0)),!$element.hasClass("ng-pristine")||"runCustomValidations"===eventType){successFn=formatterArgs.success||function(){},currentErrorMessage=getCurrentlyDisplayingErrorMessage(),currentlyDisplayingAnErrorMessage=currentErrorMessage.length>0,value=getElementValue(),"validationFieldRequired"===formatterArgs.customValidationAttribute&&toggleRequiredLabelClass(),isValid=evaluateAsValid===!0?!0:runValidation(),ngModelController.$setValidity(formatterArgs.customValidationAttribute.toLowerCase(),isValid);var status=isValid===!0?" passed":" failed";return customValidationBroadcastArg={isValid:isValid,validation:$element.attr("id")+" "+formatterArgs.customValidationAttribute+status,model:model,controller:ngModelController,element:$element},currentlyDisplayingAnErrorMessage?isCurrentlyDisplayingAnErrorMessageInATemplate($element)||whenIsNotCurrentlyDisplayingAnErrorMessageInATemplate():whenIsNotCurrentlyDisplayingAnErrorMessage(),isCurrentlyDisplayingAnErrorMessageInATemplate($element)&&whenIsCurrentlyDisplayingAnErrorMessageInATemplate(),$scope.$broadcast("customValidationComplete",customValidationBroadcastArg),onValidationComplete(!(currentlyDisplayingAnErrorMessage||isCurrentlyDisplayingAnErrorMessageInATemplate($element)||!isValid),value,validationAttributeValue,$element,model,ngModelController,$scope,successFn),value}},isValidValidationAttributeValue===!0&&(modelName=$attrs.ngModel.substring(0,$attrs.ngModel.indexOf(".")),propertyName=$attrs.ngModel.substring($attrs.ngModel.indexOf(".")+1),model=$scope[modelName],installErrorMessageElement(),installSpecialErrorCases(),ngModelController.$parsers.push(function(){return runCustomValidations("input")}),$element.on("blur",function(event){runCustomValidations(event.type)}),$scope.$on("runCustomValidations",function(){runCustomValidations("runCustomValidations")}))})}},customValidationsModule=angular.module("directives.customvalidation.customValidations",["directives.invalidinputformatter.invalidInputFormatter","services.templateRetriever"]).factory("customValidationUtil",["templateRetriever","$q","$timeout","$log",function(templateRetriever,$q,$timeout,$log){return{createValidationLink:function(customValidation){return customValidations.push(customValidation),createValidationFormatterLink(customValidation,templateRetriever,$q,$timeout,$log)}}}]).directive("input",["customValidationUtil",function(customValidationUtil){return{require:"?ngModel",restrict:"E",link:customValidationUtil.createValidationLink(dynamicallyDefinedValidation)}}]).directive("select",["customValidationUtil",function(customValidationUtil){return{require:"?ngModel",restrict:"E",link:customValidationUtil.createValidationLink(dynamicallyDefinedValidation)}}]).directive("select",["customValidationUtil",function(customValidationUtil){return{require:"?ngModel",restrict:"E",link:customValidationUtil.createValidationLink({customValidationAttribute:"validationFieldRequired",validateWhileEntering:!0,errorMessage:"This is a required field",validator:function(errorMessageElement,val){return/\S/.test(val)}})}}]).directive("button",["customValidationUtil",function(customValidationUtil){return{restrict:"E",link:submitLink}}]).directive("a",["customValidationUtil",function(customValidationUtil){return{restrict:"E",link:submitLink}}]),{getValidationAttributeValue:getValidationAttributeValue}}(),function(){var extendCustomValidations=angular.module("directives.customvalidation.customValidationTypes",["directives.customvalidation.customValidations"]);extendCustomValidations.provider("myValidations",function(){getValidationAttributeValue=angular_ui_form_validations.getValidationAttributeValue;var outOfBoxValidations=[{customValidationAttribute:"validationFieldRequired",errorMessage:"This is a required field",validator:function(errorMessageElement,val){return/\S/.test(val)}},{customValidationAttribute:"validationConfirmPassword",errorMessage:"Passwords do not match.",validator:function(errorMessageElement,val,attr,element,model,modelCtrl){return!0}},{customValidationAttribute:"validationEmail",errorMessage:"Please enter a valid email",validator:function(errorMessageElement,val){return/^.*@.*\..*[a-z]$/i.test(val)}},{customValidationAttribute:"validationNoSpace",errorMessage:"Cannot contain any spaces",validateWhileEntering:!0,validator:function(errorMessageElement,val){return"undefined"!=typeof val&&""===val.trim()?!0:""!==val&&/^[^\s]+$/.test(val)}},{customValidationAttribute:"validationSetLength",errorMessage:"",validator:function(errorMessageElement,val,attr,$element,model,ngModelController,$scope,rawAttr){var customMessage=getValidationAttributeValue(rawAttr,"message",!0);return val.length===parseInt(getValidationAttributeValue(rawAttr),10)?!0:(errorMessageElement.html(customMessage||"Set number of characters allowed is "+getValidationAttributeValue(rawAttr)),!1)}},{customValidationAttribute:"validationMinLength",errorMessage:function(attr){return"Minimum of "+getValidationAttributeValue(attr)+" characters"},validator:function(errorMessageElement,val,attr){return val.length>=parseInt(getValidationAttributeValue(attr),10)}},{customValidationAttribute:"validationMaxLength",errorMessage:"",validateWhileEntering:!0,validator:function(errorMessageElement,val,attr,$element,model,ngModelController,$scope,rawAttr){var customMessage=getValidationAttributeValue(rawAttr,"message",!0);return val.length<=parseInt(getValidationAttributeValue(rawAttr),10)?!0:(errorMessageElement.html(customMessage||"Maximum of "+getValidationAttributeValue(rawAttr)+" characters"),!1)}},{customValidationAttribute:"validationOnlyAlphabets",errorMessage:"Valid characters are: A-Z, a-z",validateWhileEntering:!0,validator:function(errorMessageElement,val){return/^[a-z]*$/i.test(val)}},{customValidationAttribute:"validationOnlyAlphabets",errorMessage:"Valid characters are: A-Z, a-z",validateWhileEntering:!0,validator:function(errorMessageElement,val){return/^[a-z]*$/i.test(val)}},{customValidationAttribute:"validationOneUpperCaseLetter",errorMessage:"Must contain at least one uppercase letter",validator:function(errorMessageElement,val){return/^(?=.*[A-Z]).+$/.test(val)}},{customValidationAttribute:"validationOnlyNumbers",errorMessage:"Must contain only numbers",validator:function(errorMessageElement,val){return/^[0-9]*$/i.test(val)}},{customValidationAttribute:"validationOneNumber",errorMessage:"Must contain at least one number",validator:function(errorMessageElement,val){return/^(?=.*[0-9]).+$/.test(val)}},{customValidationAttribute:"validationOneAlphabet",errorMessage:"Must contain at least one alphabet",validator:function(errorMessageElement,val){return/^(?=.*[a-z]).+$/i.test(val)}},{customValidationAttribute:"validationNoSpecialChars",validateWhileEntering:!0,errorMessage:"Valid characters are: A-Z, a-z, 0-9",validator:function(errorMessageElement,val){return/^[a-z0-9_\-\s]*$/i.test(val)}},{customValidationAttribute:"validationDateBeforeToday",errorMessage:"Must be prior to today",validator:function(errorMessageElement,val){var now,dateValue;return now=new Date,dateValue=new Date(val),dateValue.setDate(dateValue.getDate()+1),now>dateValue}},{customValidationAttribute:"validationDateBefore",errorMessage:function(attr){return"Must be before "+getValidationAttributeValue(attr)},validator:function(errorMessageElement,val,beforeDate){var dateValue=new Date(val);return dateValue.setDate(dateValue.getDate()+1),dateValue<new Date(beforeDate)}},{customValidationAttribute:"validationDateAfter",errorMessage:function(attr){return"Must be after "+getValidationAttributeValue(attr)},validator:function(errorMessageElement,val,afterDate){var dateValue=new Date(val);return dateValue.setDate(dateValue.getDate()+1),dateValue.setHours(0),dateValue>new Date(afterDate)}}],userCustomValidations=[];this.addCustomValidations=function(validations){userCustomValidations=userCustomValidations.concat(validations)};var compileProvider;this.setCompileProvider=function(cp){compileProvider=cp};var Validations=function(){this.compileDirective=function(name,constructor){compileProvider.directive.apply(null,[name,constructor])},this.fetch=function(){return userCustomValidations.concat(outOfBoxValidations)}};this.$get=function(){return new Validations}}),extendCustomValidations.config(["$compileProvider","myValidationsProvider",function($compileProvider,myValidationsProvider){myValidationsProvider.setCompileProvider($compileProvider)}]),extendCustomValidations.run(["myValidations",function(myValidations){angular.forEach(myValidations.fetch(),function(customValidation){myValidations.compileDirective("input",function(customValidationUtil){return{require:"?ngModel",restrict:"E",link:customValidationUtil.createValidationLink(customValidation)}}),myValidations.compileDirective("textarea",function(customValidationUtil){return{require:"?ngModel",restrict:"E",link:customValidationUtil.createValidationLink(customValidation)}})})}])}(),angular.module("directives.invalidinputformatter.invalidInputFormatter",[]).directive("input",function(){return{require:"?ngModel",restrict:"E",link:function($scope,$element,$attrs,ngModelController){var inputType=angular.lowercase($attrs.type);ngModelController&&"radio"!==inputType&&"checkbox"!==inputType&&ngModelController.$formatters.unshift(function(value){return ngModelController.$invalid&&angular.isUndefined(value)&&"string"==typeof ngModelController.$modelValue?ngModelController.$modelValue:value})}}});